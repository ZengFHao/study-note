# 计组2考试复习大纲

@author：zfh

## 题型

- 选择题15个：每个两分
  - 基本概念
- 简答题（20-25分）
- 计算题（50分左右）
  - 流水线
    - 性能指标的分析
    - 流水线的安排
  - 输入输出系统
    - 总线
    - 输入输出设备：磁盘
    - 输入输出技术：中断，DMA
    - 输入输出接口的软硬件设计

## 流水线

- 述

  - 什么是流水线：将一个重复的处理过程分解为若干子过程，每个子过程都可以有效地在其专用功能段上与其他子过程同时进行

    - 也就是增加并发，不是完美的并行而是交错复用处理硬件
    - 有一个冷启动时间，在其之后流水线才能饱和运行

  - 流水线是由多个级或者多个段来构成的，段和段之间保证同步设置了一些锁存器

  -  流水线的特点

    - 段
    - 每个子过程由专门的功能段实现，各功能段的时间应基本相同，通常一个时间周期
    - 流水线的通过时间：也就是冷启动时间
    - 流水线适合于大量重复的过程

  - ==时空图！！==

    - 画法

    - 利用时空图进行流水线分析

    - 流水线的分类

      - 按功能划分

        - 单功能：在同一时间只能完成一种固定功能的流水线
        - 多功能：在各段可以进行不同的连接，从而完成不同的功能

      - 按动静态划分（只有多功能才能进行这样的划分）

        - 静态流水线：在同一时间段，流水线各段只能按同一种功能的连接方式进行工作，输出中间会断档

        ![image-20230307190904866](image\image-20230307190904866.png)

        - 动态流水线：在同一时间内，当某些段正在实现某种运算时，另一些段却在实现另一种计算，输出是连续的不会中间断档

        ![image-20230307190938145](image\image-20230307190938145.png)

        >
        >
        >第二个输入一没有直接连接在n后的原因：防止输出堵塞，要是这么做的话，一的输出就会被n-1挡住形成阻塞

      - 按流水级别进行划分

        - 部件级流水线：又叫运算操作流水线，把处理机的算术逻辑部件分段，使得各种数据类型的操作能够进行流水（当级别过多的时候基本都是）
        - 处理机级流水线：又叫指令流水线，是把解释指令的过程按照流水方式处理
        - 处理机间流水线，又叫宏流水线，是两个以上的处理机串行对同一数据流进行处理，每个处理机完成一项工作

      - 按输出顺序和输入顺序是否相同划分

        - 顺序流动流水线：流水线输出顺序和输入顺序相同
        - 乱序流动流水线，又称无序流水线，错序流水线，和上者相反

  - 流水线的性能指标

    - 吞吐率 ：在单位时间内流水线所完成的任务数或者输出结果的数量 

      - 最大吞吐率：流水线稳定后的吞吐率

        - 各段时间相等：$TP_{max}=1/\Delta t_0$
        - 各段时间不等：$TP_{max}=1/max{\Delta t_i}$

        >
        >
        >取决于时间最长的一段，相当于木桶效应他在扯大家后腿

      - 实际吞吐率：要加上前面的冷却时间

    - ==最大吞吐率瓶颈的消除==

      ![image-20230307192620813](image\image-20230307192620813.png)

      >
      >
      >2没有直接跟在1后面的原因和之前类似，跟着1则下一阶段2就会被阻塞住，流水线一旦开始便需要一直运转不能被阻塞

      - 细分瓶颈段（分最慢的一段，增加流水线的级数）

        ![image-20230307192559839](image\image-20230307192559839.png)

      - 重复设置瓶颈段

        ![image-20230307211634141](image\image-20230307211634141.png)

    - 实际吞吐率：

      - 各段时间相同：$T_{流水}=m\Delta t_0+(n-1)\Delta t_0$

        >
        >
        >前者为CD段，后者为流水段

      ![image-20230307192908267](image\image-20230307192908267.png)

      ![image-20230307193005634](image\image-20230307193005634.png)

      - 各段时间不同：$T=\sum_{i=1}^n\Delta t_i+(n-1)max{\Delta ti}$

        ![image-20230307193546692](image\image-20230307193546692.png)

    - 加速比：流水线速度与非流水线速度之比
      $$
      加速比S=\frac{T_{非流水}}{T_{流水}}
      $$
      
      $$
      T_{非流水}=nm\Delta t_0
      $$
      
      $$
      T_{流水}=m \Delta t_0+(n-1)\Delta t_0
      $$
      
    - 效率
      - 如上图用白色框的面积除以总的（加上所以虚线框的）面积
    
    ![image-20230307193654710](image\image-20230307193654710.png)
    
    ![image-20230307193919878](image\image-20230307193919878.png)
    
    ![image-20230307193933010](image\image-20230307193933010.png)
    
    ![image-20230307194020308](image\image-20230307194020308.png)
  
- 流水线相关

  - 概念：相邻或相近的两条指令因存在某种关联，后一条指令不能在原先指定的周期进行执行

  - 消除相关的基本方法：暂停

  - 相关的类型

    - 结构相关：硬件资源不足导致的相关

      - 原因：

        - 功能部件不是全流水
        - 重复设置的资源数量不足

      - 解决的办法：

        - 暂停
        - 设置相互独立的指令存储器和数据存储区或者设置相互独立的指令cache和数据cache

        ![image-20230307194604432](image\image-20230307194604432.png)
        
        >
        >
        >指令i还在写回的时候，i+3的取指操作是不能进行的得stall一个周期
  
    - 数据相关：后续指令需要用到前面指令的结果倒是不能流水，又称为局部性相关
  
      - 种类
        - 写后读：在完成i写回之前另一级j读取该数据（最常见的）
        
        - 写后写： j在i之前完成写操作，R中保存了错误的结果
        
          >
          >
          >如：c=a+b（i）c=m+n（j）
          >
          >本来应该存入j指令的值，也就是c=m+n，但现在的CPU都是乱序执行+预测执行+多核心+多线程，所以就可能先执行了j的指令在执行了i，导致最终存入的是c=a+b的值
        
        - 读后写：j先写入R，i读出错误的结果
        
          >
          >
          >如：c=A+B[1000h] （i） A=m+n （j）
          >
          >在执行i指令的时候需要计算地址偏移，所以花费的世界较长，这个时候j可以一下子就算完了，把A的新值写回了，这个时候c还在计算地址偏移没拿到数据，A的值已经被修改了
        
        - 读后读：不会引起数据相关
        
      - 解决办法：插入暂停周期，或者中间插入一些非相关的指令
        - 采用直通技术：直接将指令的结果从产生的地方直接连通到当前指令所在的地方
        - 增加专用部件：当发现数据相关时，使流水线停顿下来，知道相关消失为止
        - 利用编译器：对指令重新排序或者插入空操作指令
  
    - 控制相关：流水线遇到分支和其他会改变PC值的指令存在
  
      - 无条件跳转：明确知道跳哪，则取出的数据一定是对的所以不会有问题
      - 条件跳转：跳不跳？跳到哪？都不知道，比如如果不跳取出来的又是跳之后的值则明显会出错
        - 冻结流水线：等到条件明确之后才进行取值操作，流水线先暂停，会严重影响性能
        - 预取分支目标：把所有可能的数据都先搬到cache中
        - 多流：把所有分支都取出来，所有可能同时进行
        - 循环缓冲器：也就是cache， 把最近获取的指令都存下来，当分支发生的时候先检查硬件中有没有，有的话就从缓冲器中取出
        - 分支预测：我就赌他跳转或者不跳转，如果不对就把之前的结果全抛弃重新取址译码
          - 分支预测表
          - 分支历史表
        - 延迟分支：设置延迟槽
  
  - 超标量和超流水
  
    - 超标量：内置多个流水线一起跑，借助硬件资源来实现并行
    
    - 超流水：将流水线中的取址译码等操作进一步划分
    
      >
      >
      >也就对应当各阶段流水时间不同的时候，优化流水线的两种方式，将段拆开，或者增加硬件将段并行



## 输入输出系统

- 总线：之所以引入总线的概念是，由于早期计算机外部设备较少大多采用分散连接的方式，设备两个之间都有专门的数据通路，这样不易实现设备的增减，所以引入总线

  - 总线的类型

    - 数据传输的格式分类

      - 串行：数据是一位一位的传到总线，又一位一位的传给设备 
        - 优点：只需一根传输线，成本低，广泛运用与远距离传输，在计算机内部可节省空间，速度是高于并行的
        - 缺点：数据在传输和接收的过程中需要将数据进行拆卸和重组，需要考虑串并转化
      - 并行：数据同时放到不同的总线地址线上，同时传同时收
        - 优点：电路实现简单，逻辑时序简单
        - 缺点：信号线数量多，占空间，还可能发生串扰

    - 按总线的功能分类

      - 片内总线：芯片内部的总线，即CPU和内部寄存器之间的公共连接线

      - 系统总线：连接计算机内各功能部件（CPU，主存，IO设备之间）的总线

        - 数据总线：双向
        - 地址总线：单向
        - 控制总线：单向

        ![image-20230308122422809](image\image-20230308122422809.png) 

      - 通信总线：用于计算机系统之间和计算机系统和其他系统之间进行信息传递的总线，又称外部总线

    - 按时序控制方式分类

      - 同步总线
      - 异步总线

  - 系统总线的结构

    - 单总线：所有设备都插到一组总线上，允许各设备之间之间交换信息

      - 优点：成本低，结构简单，容易增减设备
      - 缺点：所有设备想要通信就要争夺总线，所以带宽低，负载重，不能并发操作

      ![image-20230308122955786](image\image-20230308122955786.png)

    - 双总线：主存总线+IO总线（通过一个通道连接），将IO单独用一条总线连接

      - 优点：把低速的IO踢出总线，实现了存储总线和IO总线的分离
      - 缺点：需要增加通道等额外硬件

      ![image-20230308123243246](image\image-20230308123243246.png)

    - 三总线：主存总线+IO总线+DMA总线

      - DMA：进行直接内存访问，高速的外设可以直接和主存进行交流而不用通过通道，低速外设还是连在IO总线上
      - 优点：提高了IO设备的性能，能更快的响应命令，提高了系统吞吐量
      - 缺点：同一时间只能有一条总线在工作，所以系统的工作效率是比较低的

      ![image-20230308123552016](image\image-20230308123552016.png)

  - 总线的性能指标

    - 带宽：总线的最大数据传输率，数据传输率即每秒传输的字节数（也就是所能达到的最高传输速率）
      $$
      总线带宽=数据线宽度 \times 总线频率
      $$
      ![image-20230307195743304](image\image-20230307195743304.png)

    - 宽度：总线的线数，即有几根线，决定了总线所占的物理空间和成本，总线上能同时传送数据的位数，又称总线位宽

      - 地址线宽度
      - 数据线宽度

    - 负载：连接在总线上的最大设备数量

    - 频率

    - 是否支持猝发传送：一次总线事务中，主设备只需给一个首地址，设备就能从首地址开始的若干个连续数据单元读出或写入多个数据

    ![image-20230308124535906](image\image-20230308124535906.png)

  - 总线仲裁：当多个设备同时提出占用总线的请求时，以某种方式选择其中的一个设备占用总线

    - 集中式仲裁：有一个总线控制器，当多个设备要同时使用总线的时候，由总线控制器进行裁定，谁的优先级高谁就用 
    - 分布式仲裁：不需要中央仲裁器，每个潜在的功能模块都有自己的仲裁号和仲裁器，当有总线请求时，把自己的仲裁号共享到仲裁总线上， 把总线上的仲裁号和自己的比较，如果总线上的优先级高则不予响应自己的请求，并撤销仲裁号

  - 典型总线的类型

    - ISA：数据传输需要CPU或DMA接口管理，传输速率低，CPU占用率高，占用硬件中断资源，不支持总线仲裁
    - PCI：
      - 高性能：不依附于某个具体的处理器，支持突发传送
      - 每条总线支持256个设备
      - 支持即插即用
      - 支持256条PCI总线
      - 低功耗
      - 支持猝发式事务处理
    - USB：
      - 性能优良
      - 即插即用
      - 适用范围广
      - 支持实时数据操作
      - 灵活健壮

- 外部设备

  - 输入设备（没学）

  - 输出设备（没学）

  - 外部存储设备：磁存储器，光存储器（没学）

    - 磁记录方式

      ![image-20230308132956069](image\image-20230308132956069.png)

      >
      >
      >对于三个，名字，波形，二进制数要能知二求第三个

    - 性能指标

      - 自同步能力：从单个磁道读出脉冲序列中提取同步时钟脉冲的难易程度

      $$
      R=最小磁化翻转间隔/最大磁化翻转间隔
      $$

      

      - 编码效率：位密度与最大磁化翻转密度之比
      
        >
        >
        >![image-20230309104906963](image\image-20230309104906963.png)
    
  - 磁存储器的结构

    - 磁头数：也就是记录面的数量，每个记录面上都有一个磁头来进行读写操作

      ![image-20230308141211511](image\image-20230308141211511.png)

    - 柱面数：就是每一个磁面有多少磁道 ，就是一个个圆周 

      ![image-20230308141411655](image\image-20230308141411655.png)

    - 扇区数：也就是把每个磁道按照扇形进行分隔

      - 扇区又称为是块，是磁盘最小的读写单位，磁盘不想内存那样可以只读几个bit，磁盘你要读就读一整个扇区，是按块存取的

      ![image-20230308141511647](image\image-20230308141511647.png)

  - 磁存储器的指标计算

    - 存储密度
      - 道密度：半径方向长度上的磁道数目（红色）
      
      - 位密度：圆周方向每个磁道单位长度能记录的二进制代码位数（绿色）
      
        ![image-20230308142411984](image\image-20230308142411984.png)
      
    - 存储容量：一个磁盘所能存储的字节总数
      - 非格式化容量：磁记录表面可利用的单元总数
        $$
        非格式化容量=位密度 \times 内圈磁道周长 \times 每面磁道数 \times 面数
        $$
        
      - 格式化容量：按照某种特定的记录格式所能存储信息的总量
      
        >$$
        >格式化容量=每个扇区字节数\times 每个磁道的扇区数 \times 每个面的磁道数 \times 面数
        >$$
        >
        >
        >
        >非格式化的容量肯定会比格式化大，格式化的提出因为扇区靠内的面积小可利用的磁化单元就少，但我们其实想的是扇区的每一个磁道存一样多的信息就方便管理了
      
    -  平均寻址时间
      - 寻道时间：与磁头径向移动速度有关 （只能沿着半径方向移动）
      
      - 旋转等待时间：与磁盘旋转速度有关
      
        ![image-20230308142711477](image\image-20230308142711477.png)
      
        >
        >
        >磁盘的寻址是先将磁头移动到所需扇区的圆周上，再转动磁盘使磁头能够在所需磁道之上
      
    - 转速：也就是磁盘的选择速度
    
    - 数据传输率：磁盘在单位时间内向主机传送数据的字节数
      $$
      数据传输率=扇区内字节数 \times 每道扇区数 \times 磁盘转速
      $$
      
    
  - 磁盘阵列的相关概念
  
    - RAID优点
      - 成本低，功耗小，传输速率高
      - 可以提供容错功能
      - 在相同容量下，RAID比传统大直径磁盘驱动器便宜很多  
  
- 输入输出技术

  - 接口

    - 概念：也就是两个部件之间的交接部分

    - 作用

      - 设备选址：我具体要用哪个设备，鼠标？键盘？

      - 传送命令：我具体要干什么，输入？输出？

      - 传送数据：我要输入或者输出，那我输入输出的数据总得有人来传吧

      - 反馈IO的工作状态：我总得知道你工作完没完成吧，总不能让我一直傻等吧

        ![image-20230308143946391](image\image-20230308143946391.png)

    - 两种编址方式
      - 独立编址方式：IO端口地址和存储器地址无关，CPU需要设立专门的输入输出指令来访问端口，靠不同的指令来区分不同的IO设备

        - 优点：有专门的输入输出指令则程序会更清晰易理解，且效率很高
        - 缺点：由于需要设置专门的指令，所以会增加了控制的复杂性

      - 统一编址方式：把IO端口当做存储器的单元进行地址分配，用统一的访存指令就可以访问IO端口

        - 优点：不需要专门的输入输出指令，可以让CPU直接访问IO，灵活方便，并且端口可以有很大的编址空间
        - 缺点：端口占用了内存地址，所以相对内存能存的东西就变少了，执行效率较慢

        ![image-20230308144459953](image\image-20230308144459953.png)

        

  - 输入输出方式

    - 程序直接控制

      - 输入接口和输出接口模型 

        - 利用锁存器设计输出接口

        - 利用三态门设计输入接口

          - 悬空：当EN为0的时候则悬空，相当于该芯片没被选中

          ![image-20230308193217958](image\image-20230308193217958.png)

      - 查询方式的过程（软件设计）

        - 原理：当CPU想要访问IO设备的时候给IO发送命令让其启动，然后不断的问你准备好了吗？你准备好了吗？一直等到外设准备好了之后才开始传输数据
        - 优点：接口设计简单，所需设备少
        - 缺点：CPU一直在踏步等待，这个时候CPU是不能完成其他工作的只能搁那傻等着，知道IO工作结束，效率巨拉
        
        ![image-20230307202421858](image\image-20230307202421858.png)

    - 中断

      - 概念 ：

        程序是一条一条执行的，有的程序会有等待IO设备等其他原因导致程序暂时无法继续执行，这个时候CPU干不了任何事情，但是又被占用着，于是发明了中断，当你在等的时候先把CPU让出来我先用着，等你等待的资源准备好了我再把CPU还给你

      - 外中断一般过程

        - 中断请求：外设->CPU，中断源向CPU发送中断请求信号
        - 中断响应：
          - 响应中断的条件是否满足
          - 中断判优：当有多个中断申请的时候具体响应哪个
        - 中断处理：运行中断服务程序
        - 中断返回：断点的恢复与返回

      - 技术

        - 中断屏蔽技术：用于多重中断
          - 在中断服务程序中提前设置开中断指令
          - 优先级高的中断源有权中断优先级低的中断

      - 响应条件

        - 中断源有中断请求
        - CPU允许中断
        - 一条指令执行完毕并且没有更紧急的任务

      - 信号类型

        - 电平类中断请求信号：中断请求信号保持至被CPU发现，CPU响应后撤销中断请求信号
        - 边沿类中断请求信号：中断请求信号的锁存和撤销，CPU能够即时予以响应的中断

      - 断点保护
        - 断点信息：断点地址，断点状态
        - 断点保护：保护断点信息
          - 设置为关中断：保护现场，在这期间不能有新的中断
          - 保存断点：当中断程序执行结束之后要能切回到断点的位置，通常用压栈的形式来保存断点的地址
          - 引出中断服务程序
        - 断点恢复：恢复断点信息，也就是疯狂弹栈

      - 中断优先级

        - 硬件实现：

          - 硬件排队器：在同时有中断请求的时候硬件排队器中高优先级的先执行，当同为1时只有INIP1是1其余都是0

            ![image-20230308154557555](image\image-20230308154557555.png)

        - 软件实现

          - 排在上面的会优先检查

            ![image-20230308154821677](image\image-20230308154821677.png)

      - 中断的嵌套

        - 中断的过程中如果插入了更高级别的中断才会响应，同级、低级的中断都不响应
        - 多重中断的断点保护和恢复：利用堆栈的先入后出特点

      - 中断向量表

        - 把各个中断服务程序的入口地址统一存到主存当中
        - 知道表项
          - 低地址是IP
          - 高地址是CS
        - 把表填出来

        ![image-20230308161313191](image\image-20230308161313191.png)

      - 8259的概念
        
        - 内部结构工作方式
        - 优先级的管理

    - DMA

      - 为什么引入DMA

        - 在之前每准备好一个数据就要中断CPU，这样会导致CPU大量的时间都用于了中断服务，于是发明DMA，CPU只需要告诉DMA我需要什么，由DMA来控制IO，读取完所有数据之后再中断CPU一次把数据全给CPU，在这期间CPU都可以继续执行其他指令

      - 作用：CPU不再会被IO设备频繁打断，通过DMA存取数据这样CPU能更高效的工作

      - 常用类型

      - DMAC和CPU总线控制权的交换方式

        - CPU和DMA可能会抢夺总线的使用权访问内存

        - 三种解决方式

          - 停用CPU

            - 当DMA需要访问的时候，将主存完全交给DMA控制，这个时候CPU停止工作

            - 特点

              - 控制简单
              - CPU处于不工作的状态，未能发挥CPU对主存的利用率

              ![image-20230308164548255](image\image-20230308164548255.png)

          - CPU和DMA交替分时工作

            - 把一个CPU周期划分为C1，C2两个周期，一个周期给DMA，一个周期给CPU

            - 特点：

              - 硬件逻辑更复杂
              - 不需要对总线使用权的申请

              ![image-20230308164819681](image\image-20230308164819681.png)

          - 周期挪用

            - 对上面两种方式的折中

            - 有三种情况

              - CPU不访问：不冲突
              - CPU正在访问：CPU结束的时候立马给DMA
              - 同时申请：先给DMA

              ![image-20230308165009321](image\image-20230308165009321.png)

      - 中断断点和DMA断点的区别

        - DMA比中断的响应速度更快，级别更高，CPU周期一结束就能立马响应DMA

      - 8237的传输方式

        - 单字节传输
        - 块传输
        - 请求传输  

      - 8237传送类型

        - 接口到存储器
        - 存储器到接口
        - 存储器到存储器 

    - 通道控制方式和外围处理机方式 

      - 四层结构

        CPU与内存<——>通道<——>设备控制器<——>外围设备
      - 通道的类型和应用场合

        - 选择通道：高速，用于磁盘磁带等
        - 数组多用通道：中速
        - 字节多用通道：慢速，用于键盘，打印机等 

  - 同步通信和异步通信

    - 同步通信：在约定的波特率下，发送端和接收端的时钟严格保持一致
    - 异步通信：接收端的时钟完全独立于发送端，允许有相对延迟

- 两个芯片

  - 8255：设计并行接口
    - 基本输入输出方式
    - 适用于：
      - 简单的输入输出操作，可适用无条件数据读写方式实现与外设的交互
      - 也可将联络信号接入C口，实现查询方式
    - 进行接口的设计
    - 编写驱动程序
  - 8253：设计并时接口



## 多机系统

- 并行系统的概念
- 多机系统的分类

​		![image-20230307204033362](image\image-20230307204033362.png)

- 多处理器和多计算机系统的区别
- 多机互联
  - 交叉开关
- 典型的多处理器系统